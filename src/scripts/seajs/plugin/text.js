!function(seajs,global){function register(o){plugins[o.name]=o}function isPlugin(name){return name&&plugins.hasOwnProperty(name)}function getPluginName(ext){for(var k in plugins)if(isPlugin(k)){var exts=","+plugins[k].ext.join(",")+",";if(exts.indexOf(","+ext+",")>-1)return k}}function xhr(url,callback){var r=global.ActiveXObject?new global.ActiveXObject("Microsoft.XMLHTTP"):new global.XMLHttpRequest;return r.open("GET",url,!0),r.onreadystatechange=function(){if(4===r.readyState){if(r.status>399&&r.status<600)throw new Error("Could not load: "+url+", status = "+r.status);callback(r.responseText)}},r.send(null)}function globalEval(content){content&&/\S/.test(content)&&(global.execScript||function(content){(global.eval||eval).call(global,content)})(content)}function jsEscape(content){return content.replace(/(["\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")}function pure(uri){return uri.replace(/\?.*$/,"")}var plugins={},uriCache={},host=location.host,sameDomain=new RegExp("^(?:http://)?"+host.replace(".","."));register({name:"text",ext:[".tpl",".html"],exec:function(uri,content){globalEval('define("'+uri+'#", [], "'+jsEscape(content)+'")')}}),seajs.on("resolve",function(data){var id=data.id;if(!id)return"";var pluginName,m;(m=id.match(/^(\w+)!(.+)$/))&&isPlugin(m[1])?(pluginName=m[1],id=m[2]):(m=id.match(/[^?]+(\.\w+)(?:\?|#|$)/))&&(pluginName=getPluginName(m[1])),pluginName&&-1===id.indexOf("#")&&(id+="#");var uri=seajs.resolve(id,data.refUri);pluginName&&(uriCache[uri]=pluginName),data.uri=uri}),seajs.on("request",function(data){var uri=data.uri,requestUri=data.requestUri;-1!=uri.indexOf("html");var name=uriCache[data.uri];name&&(sameDomain.test(uri)||(requestUri="http://"+host+"/v3/template.php?q="+uri,console.log(requestUri,uri,data)),xhr(requestUri,function(content){plugins[name].exec(data.uri,content),data.onRequest()}),data.requested=!0)}),"object"==typeof process&&(xhr=function(filename,callback){callback(require("fs").readFileSync(pure(filename),"utf8"))})}(seajs,this);